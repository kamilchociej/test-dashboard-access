default:
  service:
    repository: ghcr.io/streamx-dev/streamx-blueprints
    tag: latest-jvm
  environmentFrom:
    configs:
      - test.properties
    secrets:
      - secret.properties
descriptors:
  ghcr.io/streamx-dev/streamx-blueprints/rest-ingestion:latest-jvm:
    type: ingestion
    containers:
      rest:
        image: ghcr.io/streamx-dev/streamx/rest-ingestion-service:latest-jvm
        ports:
          - 80:8080
      db:
        image: postgresql
        ports:
          - 5432:5432
  ghcr.io/streamx-dev/streamx-blueprints/processing-service:latest-jvm:
    type: processing
    containers:
      processing-function:
        image: relay-processing-service
        incoming:
          messages:
            binding: http-structured-json
        outgoing:
          relayed-messages:
            binding: http-structured-json
      db:
        image: postgresql
  ghcr.io/streamx-dev/streamx-blueprints/edge-service:latest-jvm:
    type: edge
    containers:
      server:
        image: web-delivery-service
        ports:
          - 8080:8080
        incoming:
          pages:
            binding: http-structured-json
      webserver:
        image: "docker.io/library/nginx:1.26.0"
        ports:
          - 80:80
ingestion:
  rest:
    descriptor: rest-ingestion
    containers:
      db:
        environmentFrom:
          configs:
            - ingestion-stateless-config
          secrets:
            - ingestion-stateless-secret
  rest-state:
    descriptor: rest-ingestion
    containers:
      db:
        environmentFrom:
          configs:
            - ingestion-stateful-config
          secrets:
            - ingestion-stateful-secret
processing:
  relay:
    descriptor: processing-service
    containers:
      processing-function:
        incoming:
          messages:
            ref: inbox.web-resources
        outgoing:
          relayed-messages:
            ref: outbox.web-resources
      db:
        environmentFrom:
          configs:
            - processing-stateless-config
          secrets:
            - processing-stateless-secret
  relay-state:
    descriptor: processing-service
    containers:
      processing-function:
        incoming:
          messages:
            ref: inbox.web-resources
        outgoing:
          relayed-messages:
            ref: outbox.web-resources
      db:
        environmentFrom:
          configs:
            - processing-stateful-config
          secrets:
            - processing-stateful-secret
edge:
  web:
    descriptor: edge-service
    containers:
      server:
        incoming:
          pages:
            ref: outbox.pages
      webserver:
        environmentFrom:
          configs:
            - edge-stateless-config
          secrets:
            - edge-stateless-secret
  web-state:
    descriptor: edge-service
    containers:
      server:
        incoming:
          pages:
            ref: outbox.pages
      webserver:
        environmentFrom:
          configs:
            - edge-stateful-config
          secrets:
            - edge-stateful-secret
deploymentConfig:
  ingestion:
    rest-state:
      stateful: true
  processing:
    relay-state:
      stateful: true
  edge:
    web-state:
      stateful: true
